---
title: Guards
---

import { Tabs, TabItem } from '@astrojs/starlight/components'

You can protect your [routes](../basics#routes) with guards.

A guard allows you to execute logic before a certain request reaches
a designated route handler.

Start by adding a guard to the server.

```go
package main

import (
   "github.com/razshare/frizzante/client"
   "github.com/razshare/frizzante/route"
   "github.com/razshare/frizzante/server"
	"github.com/razshare/frizzante/tag"
)

const nojson tag.Tag = 0                                    // Creates tag.
const jsonless tag.Tag = 1                                  // Creates tag.

var srv = server.New()                                      // Creates server.

func main() {
    defer server.Start(srv)                                 // Starts server.
    srv.Guards = append(srv.Guards, {                       // Adds guard.
       Name: "No Json Allowed",                             // Sets guard name. It's useful for logs.
       Handler: func(c *client.Client, allow func()) {      // Sets guard handler.
          if receive.ContentType(c) == "application/json" { // If content is of type "application/json"...
             return                                         // ..returns. This will actually terminate the connection.
          }
          allow()                                           // Allows request through.
       },
       Tags: []tag.Tag{nojson, jsonless},                   // Sets guard tags.
    })
    srv.Routes = append(srv.Routes, route.Route{            // Adds route.
       Pattern: "GET /",                                    // Sets route pattern.
       Handler: func(c *client.Client) {
          send.Message(c, "Hello.")                         // Sends message..
       },
       Tags: []tag.Tag{nojson},                             // Sets route tags. Any guard that intersects 
                                                            // with these tags will execute before any 
                                                            // request reaches the route's handler.
    })
}
```

A guard protects every route whose tags intersect with at least one of its own tags.

In this case, the `GET /` route intersects with the `No Json Allowed` guard in tag `nojson`, which means `GET /` is protected by `No Json Allowed`.

![](guards100.svg)

## Composition

Multiple guards can intersect in order to compose more advanced restrictions.

```go
const authorization tag.Tag = 0
const authentication tag.Tag = 1
const auth tag.Tag = 3
```

```go
srv.Guards = append(srv.Guards, {                   // Adds guard.
    Name: "Authorization",                          // Sets guard name. It's useful for logs.
    Handler: func(c *client.Client, allow func()) { // Sets guard handler. If allow() is never invoked, 
                                                    // the guard will reject the request.
       a := receive.Header(c, "Authorization")      // Gets "Authorization" header from the request.
       if !SuperAdvancedAuthorizationCheckTM(a) {   // If client is not authorized...
          send.Status(c, 403)                       // ...sends status 403...
          send.Message(c, "Not authorized.")        // ...and a short message with an explanation.
          return                                    // Returns. This will actually terminate the connection.
       }
       allow()                                      // Allows request through.
    },
    Tags: []tag.Tag{authorization, auth},           // Sets guard tags.
})
```

```go
srv.Guards = append(srv.Guards, {                     // Adds guard.
    Name: "Authentication",                           // Sets guard name. It's useful for logs.
    Handler: func(c *client.Client, allow func()) {   // Sets guard handler. If allow() is never invoked, 
                                                      // the guard will reject the request.
       session := session.Start(receive.SessionId(c)) // Starts session.
       if !session.SignedIn {                         // If the user is not signed in...
          send.Status(c, 403)                         // ...sends status 403...
          send.Message(c, "Not authenticated.")       // ...and a short message with an explanation.
          return                                      // Returns. This will actually terminate the connection.
       }
       allow()                                        // Allows request through.
    },
    Tags: []tag.Tag{authentication, auth},            // Sets guard tags.
})
```

```go
srv.Routes = append(srv.Routes, {     // Adds route.
    Pattern: "GET /",                 // Sets route pattern.
    Handler: func(c *client.Client) { // Sets route handler.
       send.Message(c, "Hello.")      // Sends message..
    },
    Tags: []tag.Tag{auth},            // Sets route tags. Any guard that intersects 
                                      // with these tags will execute before any 
                                      // request reaches the route's handler.
})
```

In this case, `GET /` is protected by both `Authentication` and `Authorization` guards because they all intersect int `auth`.

![](guards200.svg)


:::tip
You can still apply each guard separately with tags `authorization` and `authentication`.

<Tabs>
    <TabItem icon='open-book' label='Authorization'>
       ```go
       srv.Guards = append(srv.Guards, {    // Adds route.
          Pattern: "GET /",                 // Sets route pattern.
          Handler: func(c *client.Client) { // Sets route handler.
             send.Message(c, "Hello.")      // Sends message..
          },
          Tags: []tag.Tag{authorization},   // Sets route tags. Any guard that intersects 
                                            // with these tags will execute before any 
                                            // request reaches the route's handler.
       })
       ```
    </TabItem>
    <TabItem icon='open-book' label='Authentication'>
       ```go
       srv.Guards = append(srv.Guards, {    // Adds route.
          Pattern: "GET /",                 // Sets route pattern.
          Handler: func(c *client.Client) { // Sets route handler.
             send.Message(c, "Hello.")      // Sends message..
          },
          Tags: []tag.Tag{authentication},  // Sets route tags. Any guard that intersects 
                                            // with these tags will execute before any 
                                            // request reaches the route's handler.
       })
       ```
    </TabItem>
</Tabs>
:::