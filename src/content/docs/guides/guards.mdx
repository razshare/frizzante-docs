---
title: Guards
---

import { Tabs, TabItem } from '@astrojs/starlight/components'

You can protect your [routes](../routes) with guards.

A guard allows you to execute logic before a certain request reaches
a designated route handler.

Start by adding a guard to the server

```go
package main

import (
    "github.com/razshare/frizzante/connections"
    "github.com/razshare/frizzante/guards"
    "github.com/razshare/frizzante/routes"
    "github.com/razshare/frizzante/servers"
)

var server = servers.New()                                         // Creates a server.

func main() {
    server.AddGuard(guards.Guard{                                  // Adds a guard.
        Name: "No Json Allowed",                                   // Sets the guard's name. It's useful for logs.
        Handler: func(con *connections.Connection, allow func()) { // sets the guard's handler.
            if con.VerifyContentType("application/json") {         // If requests uses "application/json" content...
                return                                             // ..returns. This will actually terminate the connection.
            }
            allow()                                                // Allows the request through.
        },
        Tags: []string{"nojson", "jsonless"},                      // Sets the guard's tags.
    })
    server.AddRoute(routes.Route{                                  // Adds a route.
        Pattern: "GET /",                                          // Sets the route's pattern.
        Handler: func(con *connections.Connection) {
            con.SendMessage("Hello.")                              // Sends text.
        },
        Tags: []string{"nojson"},                                  // Sets the route's tags. Any guard that intersects 
                                                                   // with these tags will execute before any 
                                                                   // request reaches the route's handler.
    })
    server.Start()                                                 // Starts the server.
}
```

A guard protects every route whose tags intersect with at least one of its own tags.

In this case, the `GET /` route intersects with the `No Json Allowed` guard in `nojson`, which means `GET /` is protected by `No Json Allowed`.

![](guards100.svg)

## Composite Guards

Multiple guards can intersect in order to compose more advanced restrictions.

```go
server.AddGuard(guards.Guard{                                  // Adds a guard.
    Name: "Authorization",                                     // Sets the guard's name. It's useful for logs.
    Handler: func(con *connections.Connection, allow func()) { // Sets the guard's handler. If allow() is never invoked, 
                                                               // the guard will reject the request.

        auth := con.ReceiveHeader("Authorization")             // Gets the "Authorization" header from the request.
        if !SuperAdvancedAuthorizationCheckTM(auth) {          // If user is not authorized...
            con.SendStatus(403)                                // ...sends status 403...
            con.SendMessage("Not authorized.")                 // ...and a short message with an explanation.
            return                                             // Returns. This will actually terminate the connection.
        }
        allow()                                                // Allows the request through.
    },
    Tags: []string{"authorization", "auth"},                   // Sets the guard's tags.
})
```

```go
server.AddGuard(guards.Guard{                                  // Adds a guard.
    Name: "Authentication",                                    // Sets the guard's name. It's useful for logs.
    Handler: func(con *connections.Connection, allow func()) { // Sets the guard's handler. If allow() is never invoked, 
                                                               // the guard will reject the request.

        session := sessions.Start[State](con)                  // Starts the session.
        if !session.State.SignedIn {                           // If the use is not signed in...
            con.SendStatus(403)                                // ...sends status 403...
            con.SendMessage("Not authenticated.")              // ...and a short message with an explanation.
            return                                             // Returns. This will actually terminate the connection.
        }
        allow()                                                // Allows the request through.
    },
    Tags: []string{"authentication", "auth"},                  // Sets the guard's tags.
})
```

```go
server.AddRoute(routes.Route{                    // Adds a route.
    Pattern: "GET /",                            // Sets the route's pattern.
    Handler: func(con *connections.Connection) { // Sets the route's handler.
        con.SendMessage("Hello.")                // Sends text.
    },
    Tags: []string{"auth"},                      // Sets the route's tags. Any guard that intersects 
                                                 // with these tags will execute before any 
                                                 // request reaches the route's handler.
})
```

![](guards200.svg)


:::tip
You can still apply each guard separately with tags `authorization` and `authentication`.

<Tabs>
    <TabItem icon='open-book' label='Authorization'>
        ```go
        server.AddRoute(routes.Route{                    // Adds a route.
            Pattern: "GET /",                            // Sets the route's pattern.
            Handler: func(con *connections.Connection) { // Sets the route's handler.
                con.SendMessage("Hello.")                // Sends text.
            },
            Tags: []string{"authorization"},            // Sets the route's tags. Any guard that intersects 
                                                        // with these tags will execute before any 
                                                        // request reaches the route's handler.
        })
        ```
    </TabItem>
    <TabItem icon='open-book' label='Authentication'>
        ```go
        server.AddRoute(routes.Route{                    // Adds a route.
            Pattern: "GET /",                            // Sets the route's pattern.
            Handler: func(con *connections.Connection) { // Sets the route's handler.
                con.SendMessage("Hello.")                // Sends text.
            },
            Tags: []string{"authentication"},           // Sets the route's tags. Any guard that intersects 
                                                        // with these tags will execute before any 
                                                        // request reaches the route's handler.
        })
        ```
    </TabItem>
</Tabs>
:::